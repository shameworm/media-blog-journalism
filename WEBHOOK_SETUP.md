# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Sanity Webhook –¥–ª—è Instant Revalidation

–¶–µ–π –≥–∞–π–¥ –¥–æ–ø–æ–º–æ–∂–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∞–π—Ç—É –ø—Ä–∏ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–Ω—Ç—É –≤ Sanity Studio.

## –©–æ —Ü–µ –¥–∞—î?

- ‚úÖ **–ú–∏—Ç—Ç—î–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** –∫–æ–Ω—Ç–µ–Ω—Ç—É –Ω–∞ –ø—Ä–æ–¥—ñ –ø—ñ—Å–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
- ‚úÖ –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ —á–µ–∫–∞—Ç–∏ 60 —Å–µ–∫—É–Ω–¥ (ISR timeout)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫

---

## –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ .env.local

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ —É –≤–∞—Å —î —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á:

```env
SANITY_REVALIDATE_SECRET=your-secret-key-here-change-this-in-production
```

‚ö†Ô∏è **–í–ê–ñ–õ–ò–í–û**: –ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å–∫–ª–∞–¥–Ω–∏–π –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –∫–ª—é—á!

–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –º–æ–∂–Ω–∞ —Ç–∞–∫:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

---

## –ö—Ä–æ–∫ 2: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ Webhook –≤ Sanity

### 2.1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Sanity Dashboard

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ https://www.sanity.io/manage

### 2.2. –í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç

–ó–Ω–∞–π–¥—ñ—Ç—å —Å–≤—ñ–π –ø—Ä–æ–µ–∫—Ç `irtwns5j` (media-blog-journalism)

### 2.3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ Webhooks

–í –±—ñ—á–Ω–æ–º—É –º–µ–Ω—é:
- API ‚Üí **Webhooks**
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Create webhook"**

### 2.4. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É

**Name:**
```
Production Revalidation
```

**URL:**
```
https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/revalidate?secret=your-secret-key-here-change-this-in-production
```

–ó–∞–º—ñ–Ω—ñ—Ç—å:
- `–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω–∏–π –¥–æ–º–µ–Ω
- `your-secret-key-here-change-this-in-production` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω–∏–π —Å–µ–∫—Ä–µ—Ç –∑ `.env.local`

**Dataset:**
```
production
```

**Trigger on:**
- ‚úÖ Create
- ‚úÖ Update
- ‚úÖ Delete

**Filter (GROQ):**
```groq
_type in ["biography", "reflection", "largeProject", "teamMember"]
```

–¶–µ–π —Ñ—ñ–ª—å—Ç—Ä –∑–∞–±–µ–∑–ø–µ—á—É—î —â–æ webhook —Å–ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤.

**Projection (GROQ):**
```groq
{
  _id,
  _type,
  "slug": slug.current
}
```

–¶–µ –º—ñ–Ω—ñ–º—ñ–∑—É—î —Ä–æ–∑–º—ñ—Ä payload —ñ –ø–µ—Ä–µ–¥–∞—î —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

**HTTP method:**
```
POST
```

**HTTP Headers:**
```
Content-Type: application/json
```

**API version:**
```
2024-01-01
```
(–∞–±–æ –Ω–∞–π–Ω–æ–≤—ñ—à–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–µ—Ä—Å—ñ—è)

### 2.5. –ó–±–µ—Ä–µ–∂—ñ—Ç—å webhook

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Save"**

---

## –ö—Ä–æ–∫ 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 3.1. –û–ø—É–±–ª—ñ–∫—É–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Sanity Studio
2. –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ –±—É–¥—å-—è–∫—É –±—ñ–æ–≥—Ä–∞—Ñ—ñ—é/—Ä–µ—Ñ–ª–µ–∫—Å—ñ—é/–ø—Ä–æ–µ–∫—Ç
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Publish"**

### 3.2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏

**–í Sanity Dashboard:**
- –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ API ‚Üí Webhooks
- –ó–Ω–∞–π–¥—ñ—Ç—å —Å–≤—ñ–π webhook
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"View logs"**
- –ü–æ–≤–∏–Ω–Ω—ñ –±–∞—á–∏—Ç–∏ —É—Å–ø—ñ—à–Ω—ñ –∑–∞–ø–∏—Ç–∏ –∑ –∫–æ–¥–æ–º `200`

**–í Vercel:**
- –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ —Å–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É
- –í–∫–ª–∞–¥–∫–∞ **"Logs"** –∞–±–æ **"Functions"**
- –®—É–∫–∞–π—Ç–µ –ª–æ–≥–∏ –≤—ñ–¥ `/api/revalidate`
- –ü–æ–≤–∏–Ω–Ω—ñ –±–∞—á–∏—Ç–∏:
  ```
  üì• –û—Ç—Ä–∏–º–∞–Ω–æ webhook –≤—ñ–¥ Sanity: { type: 'biography', id: '...', slug: '...' }
  ‚úÖ Revalidated: /
  ‚úÖ Revalidated: /biographies
  ‚úÖ Revalidated: /biographies/slug-example
  ```

### 3.3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–∞–π—Ç

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Å–∞–π—Ç
2. –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–≤–∏–Ω–µ–Ω –æ–Ω–æ–≤–∏—Ç–∏—Å—å **–ú–ò–¢–¢–Ñ–í–û** (–Ω–µ —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥!)

---

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –î–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:
```
1. üìù –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –≤ Sanity
2. ‚è∞ –ß–µ–∫–∞—î–º–æ 60 —Å–µ–∫—É–Ω–¥ (ISR)
3. ‚úÖ –°—Ç–æ—Ä—ñ–Ω–∫–∞ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
```

### –ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:
```
1. üìù –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –≤ Sanity
2. üîî Sanity –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î webhook
3. üîÑ Next.js —Ä–æ–±–∏—Ç—å revalidate
4. ‚úÖ –°—Ç–æ—Ä—ñ–Ω–∫–∞ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ú–ò–¢–¢–Ñ–í–û
```

---

## –Ø–∫—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è?

–ó–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞:

| –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ | –°—Ç–æ—Ä—ñ–Ω–∫–∏ —â–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è |
|---------------|------------------------|
| **biography** | `/`, `/biographies`, `/biographies/[slug]` |
| **reflection** | `/`, `/reflections`, `/reflections/[slug]` |
| **largeProject** | `/`, `/projects`, `/projects/[slug]` |
| **teamMember** | `/about` |

–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ `/` –∑–∞–≤–∂–¥–∏ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –¥–ª—è –±—ñ–æ–≥—Ä–∞—Ñ—ñ–π, —Ä–µ—Ñ–ª–µ–∫—Å—ñ–π —Ç–∞ –ø—Ä–æ–µ–∫—Ç—ñ–≤, –±–æ —Ç–∞–º –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è featured –∫–æ–Ω—Ç–µ–Ω—Ç.

---

## –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### Webhook –Ω–µ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL** - –≤—ñ–Ω –º–∞—î –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É (–Ω–µ localhost)
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ secret** - –º–∞—î —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏ –∑ `.env.local` (–∞–±–æ env vars –≤ Vercel)
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ—ñ–ª—å—Ç—Ä** - –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤—Ö–æ–¥–∏—Ç—å –≤ —Ñ—ñ–ª—å—Ç—Ä

### Webhook —Å–ø—Ä–∞—Ü—å–æ–≤—É—î, –∞–ª–µ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –≤ Vercel** - –º–æ–∂–ª–∏–≤–æ —î –ø–æ–º–∏–ª–∫–∏ –≤ `/api/revalidate`
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ projection** - –º–∞—î –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ `_id`, `_type`, `slug`
3. **–û—á–∏—Å—Ç—ñ—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞** - –º–æ–∂–ª–∏–≤–æ —Ü–µ –∫–µ—à –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ

### Webhook –ø–æ–≤–µ—Ä—Ç–∞—î 401 Unauthorized

- **Secret –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—î** - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ secret –≤ URL —Å–ø—ñ–≤–ø–∞–¥–∞—î –∑ env –∑–º—ñ–Ω–Ω–æ—é

### Webhook –ø–æ–≤–µ—Ä—Ç–∞—î 500 Error

- **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏** –≤ Vercel Functions
- –ú–æ–∂–ª–∏–≤–∞ –ø–æ–º–∏–ª–∫–∞ –≤ –∫–æ–¥—ñ `/api/revalidate/route.ts`

---

## Environment Variables —É Vercel

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–¥–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç –≤ Vercel:

1. Vercel Dashboard ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç
2. **Settings** ‚Üí **Environment Variables**
3. –î–æ–¥–∞–π—Ç–µ:
   - Name: `SANITY_REVALIDATE_SECRET`
   - Value: –≤–∞—à —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á
   - Environments: ‚úÖ Production (‚úÖ Preview ‚úÖ Development - –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

4. **Redeploy** –ø—Ä–æ–µ–∫—Ç –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–æ—ó

---

## –ë–µ–∑–ø–µ–∫–∞

‚ö†Ô∏è **–ù–Ü–ö–û–õ–ò** –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ —Ä–µ–∞–ª—å–Ω–∏–π secret –≤ git!

–ü—Ä–∞–≤–∏–ª—å–Ω–∏–π `.env.local`:
```env
SANITY_REVALIDATE_SECRET=—Ç—É—Ç-—Å–∫–ª–∞–¥–Ω–∏–π-–≤–∏–ø–∞–¥–∫–æ–≤–∏–π-–∫–ª—é—á-64-—Å–∏–º–≤–æ–ª–∏
```

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```env
SANITY_REVALIDATE_SECRET=123456  ‚ùå
SANITY_REVALIDATE_SECRET=my-secret  ‚ùå
```

---

## –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

- [Next.js Revalidation](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#on-demand-revalidation)
- [Sanity Webhooks Documentation](https://www.sanity.io/docs/webhooks)
- [Vercel Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä –≤–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏—Å—å –º–∏—Ç—Ç—î–≤–æ –ø—ñ—Å–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó.
